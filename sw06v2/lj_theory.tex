

\chapter{Theory of shallow water waveguide and computer models}


\section{Linear Wave Equation and Helmholtz Equation}
We start from linear wave equation 
\begin{equation}\label{TH1}
\frac{\partial\rho'}{\partial t}=-\rho_0\nabla\cdot \mathbf{v},
\end{equation}
\begin{equation}\label{TH2}
\frac{\partial\mathbf{v}}{\partial t}=-\frac{1}{\rho_0}\nabla p'(\rho),
\end{equation}
\begin{equation}\label{TH3}
p'=\rho'c^2.
\end{equation}
Where $c$ is the speed of sound in the fluid, $\rho$ is the density, $\mathbf v$ the particle velocity, $p$ the pressure. Small perturbations are used for pressure and density, $p=p_0+p'$, $\rho = \rho_0 =\rho'$. And $\mathbf v$ is also a small quantity compare to $c$.

Rearrange Eq.\ref{TH1}-Eq.\ref{TH3} to obtain a wave equation for pressure,
\begin{equation}\label{TH4}
\rho \nabla \cdot \left(\frac{1}{\rho}\nabla  p \right)-\frac{1}{c^2}\frac{\partial^2p}{\partial t^2} = 0,
\end{equation}
where we have omitted the primes for pressure and density perturbations.
If the density is constant is space, Eq.\ref{TH4} can be replaced by
\begin{equation}\label{TH4a}
\nabla^2p-\frac{1}{c^2}\frac{\partial^2p}{\partial t^2}=0.
\end{equation}
The coefficients to the two differential operators in Eq.\ref{TH4} are independent of time, by use of the Forier transform, the wave equation becomes to Helmholtz equation,
\begin{equation}\label{TH5}
\rho \nabla \cdot \left(\frac{1}{\rho}\nabla  p \right)+k(\mathbf{r})^2 p = 0,
\end{equation}
or, in the case of constant density,
\begin{equation}\label{TH5a}
\nabla^2p+k(\mathbf{r})^2p=0.
\end{equation}
where $k(\mathbf{r})$ is the medium wavenumber at radial frequency $\omega$,
\begin{equation}
k(\mathbf{r})=\frac{\omega}{c(\mathbf{r})}.
\end{equation}
\section{Normal Modes}
\subsection{Normal Modes for Range-Independent Environments }
In a cylindrical coordinate system $\mathbf r =(r,\varphi,z), $ assuming sound speed and density depending only on depth $z$, with a point source located at coordinates $r=0,z=z_s$, 
%substitute the Laplace operator in the Helmholtz equation Eq.\ref{TH4a} with
%\begin{equation}
%\nabla^2=\frac{1}{r}\frac{\partial}{\partial r}r\frac{\partial}{\partial r}+\frac{1}{r^2}\frac{\partial ^2}{\partial \varphi ^2}+\frac{\partial ^2}{\partial z^2}
%\end{equation}
the Helmholtz equation:
\begin{equation}\label{TH9}
\frac{1}{r}\frac{\partial}{\partial r}\left(r\frac{\partial p}{\partial r}\right) + \rho (z) \frac{\partial}{\partial z}\left(\frac{1}{\rho(z)}\frac{\partial p}{\partial z}\right ) + \frac {\omega ^2}{c^2(z)}p=-\frac{\delta(r)\delta(z-z_s)}{2\pi r}.
\end{equation}
Eq.\ref{TH9} is readily solved via the technique of separation of variables. Assuming a solution of the unforced equation in the form $p(r,z) = \Phi(r)\Psi(z)$. After substuting into the above equation and dividing through by $\Phi(r)\Psi(z)$ we find, 
\begin{equation}
\frac{1}{\Phi} \left[ \frac {1}{r} \frac{d}{dr} \left( r \frac{d\Phi}{dr}\right) \right ] + \frac{1}{\Psi} \left[ \rho(z) 
\frac{d}{dz} \left( \frac{1}{\rho(z) } \frac { d\Psi}{dz} \right) + \frac { \omega^2 } {c^2(z)} \Psi \right ] = 0. 
\end{equation}
Denoting the separation constant by $k^2_{rm}$, we obtain the modal equation,
\begin{equation}
\rho(z)\frac{d}{dz}\left[\frac{1}{\rho(z)}\frac{d\Psi_m(z)}{dz}\right]+\left[\frac{\omega^2}{c^2(z)}-k^2_{rm}\right]\Psi_m(z)=0.
\end{equation}
where $k_m$ is the mode $m$ horizontal wavenumber, and each $\Psi_m$ is subject to certain boundary conditions that depend on the environment. For instance, with a pressure-release surface located at $z=0$ and a perfectly rigid bottom located at $z=D$, the corresponding boundary condition for $\Psi$ is 
\begin{equation}
\Psi(0)=0,  \qquad  \frac{d\Psi}{dz}\Bigg|_{z=D}=0.
\end{equation}

The modal equation is a classical Sturm-Liouville eigenvalue problem whose properties are well-known. The function $\Psi_m(z)$ is an eigenfunction and $k_{rm}$ is an eigenvalue. The modes are orthogonal, i.e., 
\begin{equation}
\int^D_0\frac{\Psi_m(z)\Psi_n(z)}{\rho(z)}d(z)=0, \qquad \mbox{for} \qquad m\neq n.
\end{equation}
The solutions of the modal equation are arbitrary to a multiplicative constant, therefore the mode shape function is usually normalized so that
\begin{equation}\label{TH15}
\int^D_0\frac{\Psi^2_m(z)}{\rho(z)}dz=1.
\end{equation}
The total acoustic pressure field takes the form 
\begin{equation}
p(r,z)=\sum\limits_m\Phi_m(r)\Psi_m(z)
\end{equation}
where $\Psi_m(z)$ is the vertical modal shape, and $\Phi_m(r)$ is the mode coefficient for mode $m$ at range $r$.

\subsection{Normal Modes for Range-dependent Environments }

For a range-dependent environment, the Helmholtz equation in cylindrical coordinates is,
\begin{equation}
\frac{\rho}{r}\frac{\partial}{\partial r}\left(\frac{r}{\rho}\frac{\partial p}{\partial r}\right) + \rho \frac{\partial}{\partial z}\left(\frac{1}{\rho}\frac{\partial p}{\partial z}\right) + \frac{\omega^2}{c^2(r,z)}p = -\frac{\delta(r)\delta(z-z_s)}{2\pi r}.
\end{equation}
Since the modes form a complete set, we can represent the solution at any range as a sum of local modes. We therefore seek a solution of the range-dependent problem in the form 
\begin{equation}
p(r,z)=\sum\limits_m\Phi_m(r)\Psi_m(r,z)
\end{equation}
where $\Psi_m(r,z)$ are the local modes defined by
\begin{equation}
\rho(r,z)\frac{\partial}{\partial z} \left[ \frac{1}{\rho(r,z)}\frac{\partial \Psi_m(r,z)}{\partial z}\right] +\left[\frac{\omega^2}{c^2(r,z)}-k^2_{rm}(r)\right]\Psi_m(r,z)=0.
\end{equation}
Thus, at any range $r$, $\Psi)m(r,z)$ is found by solving the depth-separated modal equation with the environmental properties at that range. Substitution in the Helmholtz equation yields
\begin{equation}
\sum\limits_m\frac{\rho}{r}\frac{\partial}{\partial r}\left(\frac{r}{\rho}\frac{\partial(\Phi_m\Psi_m)}{\partial r}\right)+ \sum\limits_mk^2_{rm}(r)\Phi_m\Psi_m=-\frac{\delta(r)\delta(z-z_s)}{2\pi r}.
\end{equation}
We now assume that $\rho$ is independent of $r$. We can apply the operator
\begin{equation}
\int(\cdot)\frac{\Psi_n(r,z)}{\rho}dz,
\end{equation}
and because of the orthogonality property many of the terms in the sum will disappear. The result is 
\begin{equation}\label{TH21}
\frac{1}{r}\frac{d}{dr}\left(r\frac{d\Phi_n}{dr}\right) + \sum\limits_m2B_{mn}\frac{d\Phi_m}{dr}+\sum\limits_mA_{mn}\Phi_m+k*2_{rn}(r)\Phi_n=-\frac{\delta(r)\Psi_n(z_s)}{2\pi r},
\end{equation}
where
\begin{equation}
A_{mn}=\int\frac{1}{r}\frac{\partial}{\partial r}\left(r\frac{\partial\Psi_m}{\partial r}\right)\frac{\Psi_n}{\rho}dz,
\end{equation}
\begin{equation}
B_{mn}=\int\frac{\partial \Psi_m}{\partial r}\frac{\Psi_n}{\rho}dz.
\end{equation}
Equation \ref{TH21} is a statement of coupled modes written for the case of continuous variation of sound speed. It can be solved directly by, for instance finite-differences. The adiabatic approximation can now be stated simply as the assumption that the coupling matrics $A_{mn}$ and $B_{mn}$ are negligible. We then obtain a set of decoupled equations,
\begin{equation}
\frac{1}{r}\frac{d}{dr}\left(r\frac{d\Phi_n}{dr}\right)+k_{rn}^2(r)\Phi_n=-\frac{\delta(r)\Psi_n(z_s)}{2\pi r}
\end{equation}

\subsection{Normal Modes for 3-D Environments}
To extend the 2-D model to a 3-D model, a direct approach is to simply running the 2-D models repeatedly along a number of different bearings. Along each bearing one then uses the sound-speed profile and bathymetry for that track. Combining these results along numerous bearings allow one to build-up a 3-D image of the acoustic field, which, however, is just an N $\times$ 2-D calculation where horizontal refraction has been ignored. The "Horizontal ray vertical modes" approach introduced in the next section is able to overcome this problem.

\subsubsection{Horizontal Refraction Equation}
We return to the Helmholtz equation in three dimensions,
\begin{equation}
\rho\nabla\cdot\left(\frac{1}{\rho}\nabla p\right)+\frac{\omega^2}{c^2(x,y,z)}p=-\delta(x)\delta(y)\delta(z-z_s).
\end{equation}
We seek a solution of the form
\begin{equation}
p(x,y,z)=\sum\limits_m\Phi_m(x,y)\Psi_m(x,y,z),
\end{equation}
where $\Psi_m(x,y,z)$ are the local modes. Substituting into the Helmholtz equation and applying the operator
\begin{equation}
\int(\cdot)\frac{\Psi_n(x,y,z)}{\rho}dz,
\end{equation}
yields
\begin{eqnarray}
\frac{\partial^2\Phi_n}{\partial x^2}&+&\frac{\partial^2 \Phi_n}{\partial y ^2}+k_{rn}^2(x,y)\Phi_n+\sum\limits_mA_{mn}\Phi_m
\nonumber\\
&+&\sum\limits_m2B_{mn}\frac{\partial\Phi_m}{\partial x}+\sum\limits_m2C_{mn}\frac{\partial \Phi_m}{\partial y} = -\delta(x)\delta(y)\delta(z-z_s),
\end{eqnarray}
where
\begin{eqnarray}
A_{mn}&=&\int\left(\frac{\partial^2}{\partial x^2}+\frac{\partial^2}{\partial y^2}\right)\Psi_m\frac{\Psi_n}{\rho}dz,\nonumber\\
B_{mn}&=&-B_{nm}=\int\frac{\partial\Psi_m}{\partial x}\frac{\Psi_n}{\rho}dz,\nonumber\\
C_{mn}&=&-C_{nm}=\int\frac{\partial\Psi_m}{\partial y}\frac{\Psi_n}{\rho}dz,
\end{eqnarray}
Here we have assumed that the density $\rho(z)$ depends only on depth $z$. The adiabatic approximation can then be obtained by neglecting the contributions of the coupling matrices $A,B$ and $C$. This yields the horizontal refraction equation
\begin{equation}
\frac{\partial^2\Phi_n}{\partial x^2}+\frac{\partial^2\Phi_n}{\partial y^2}+ k^2_{rn}(x,y){\Phi_n}=-\Psi_n(z_s)\delta(x)\delta(y).
\end{equation}

Using the local normal modes, we have eliminated the $z$-dimension from the problem and obtained a new Helmholtz equation, but now in the lateral coordinates $x$ and $y$. The effective index of refraction is given by the horizontal wavenumber $k_{rn}(x,y)$ so that every mode generates a corresponding Helmholtz equation. Such 2-D Helmholtz equations can be treated by various methods like normal modes, ray, or PE. In our study, we use ray model for its clear physics meaning. 
\subsection{Mode Filtering}
To the characterize the acoustic propagation through an ocean volume and internal wave tomography, one needs to estimate the normal modes propagating at a given location. 
The acoustic pressure field as superposition of local modes (Eq.\ref{TH15})
\begin{equation}
p(r,z)=\sum\limits_m\Phi_m(r)\Psi_m(r,z)
\end{equation}

The spatial samples of the pressure field observed at vertical array of $N$ hydrophones can be written as 
\begin{equation} \label{TH32}
\left[  \begin{array}{c}p(z_1)\\\vdots\\p(z_N)\end{array} \right] = \left[ 
\begin{array}{ccc}\Psi_1(z_1) & \cdots & \Psi_M(z_1)\\ \vdots&\ddots&\vdots\\\Psi_1(z_N)&\cdots&\Psi_M(z_N)\end{array} \right] \left[ \begin{array}{c} \Phi_1\\ \vdots \\ \Phi_M \end{array} \right] + \left[ \begin{array}{c} n(z_1)\\ \vdots \\ n(z_N) \end{array} \right], 
\end{equation}
or in vector notation
\begin{equation}
\mathbf{p = \Psi \Phi + n}
\end{equation}
where $\mathbf{n}$ is the vector of observation noise at the hydrophone locations, and $z_1, \ldots,z_n$ are the depths of the hydrophones. The goal of mode filtering is to estimate the mode coefficients $\mathbf{(\Phi)}$ from the observed pressure samples $\mathbf{(p)}$ under the interference of unknown noise $\mathbf{(n)}$. 

One potential issue of hydrophone array is poor spatial sampling. At times, the number of hydrophones $N$ is fewer than the number of propagating modes. In this scenario, Eq. \ref{TH32} is an underdetermined least squares problem, and thus lacks a unique solution. While it is possible to find the minimum norm solution to this equation, there is no reason to believe that the modes propagating are the set giving the minimum norm for $\mathbf\Phi$. For this reason, it is crucial to insure that the number of hydrophones in the array exceeds the number of modes that can reasonably be expected to be observed at the array for the frequency of propagation.

In order to minimize the squared error between $\mathbf{\Psi\Phi}$ and the observation $\mathbf{p}$, in this study, we use the pseudo-inverse (PI) mode filter $\mathbf{H}$ that is the pseudo-inverse of mode shape matrix $\mathbf{\Psi}$,
\begin{equation}
\mathbf{H}=(\mathbf{\Psi}^H \mathbf{\Psi})^{-1} \mathbf{\Psi} ^H
\end{equation}



\section{Parabolic Equation}
Start from the Helmholtz equation for a constant-density medium in cylindrical coordinates $(r, \varphi,z)$ and for a harmonic point source of time dependence $exp(-i\omega t)$,
\begin{equation}\label{TH35}
\frac{\partial^2 p}{\partial r^2}+\frac{1}{r}\frac{\partial p}{\partial r} + \frac{\partial^2 p}{\partial z^2}+k_0^2n^2p=0
\end{equation}
where we have assumed azimuthal symmetry and hence no dependence on the $\varphi$-coordinate. Here $p(r,z)$ is the acoustic pressure, $k_0=\omega/c_0$ is a reference wavenumber, and $n(r,z)=c_0/c(r,z)$ is the index of refraction. 
We assume the solution of Eq.\ref{TH35} to take the form 
\begin{equation}\label{TH36}
p(r,z)=\Psi(r,z)H_0^{(1)}(k_0r),
\end{equation}
in which $H_0^{(1)}  (\cdot )$ is the Hankel function of the first kind.  For $k_0r\gg1$, the Hankel function is replaced by its asymptotic form
\begin{equation}\label{TH37}
H_0^{(1)}(k_0r)\simeq\sqrt{\frac{2}{\pi k_0r}}e^{i(k_0r-\frac{\pi}{2})}.
\end{equation}
Substituting the trial solution, Eq. \ref{TH36}, into the Helmholtz equation, and makeing use of the Hankel-function property, we obtain,
\begin{equation}
\frac{\partial ^2 \Psi}{\partial r^2}+\left(\frac{2}{H_0^{(1)}(k_0r)}\frac{\partial H_0^{(1)}(k_0r)}{\partial r}+\frac{1}{r}\right)\frac{\partial\Psi}{\partial r}+\frac{\partial ^2 \Psi}{\partial z^2}+k_0^2(n^2-1)\Psi = 0.
\end{equation}
Next we make the farfield assumption, $k_0r\gg 1$, and use Eq.\ref{TH37} to obtain the simplified elliptic wave equation
\begin{equation}\label{TH39}
\frac{\partial^2\Psi}{\partial r^2}+2ik_0\frac{\partial \Psi}{\partial r}+\frac{\partial ^2 \Psi}{\partial r} + \frac{\partial ^2 \Psi}{\partial z^2}+k_0^2(n^2-1)\Psi = 0.
\end{equation}
Implicit in the farfield analysis is the small angle approximation, evident from the expression for the uniform ocean Green's function,
\begin{equation}
p=\frac{1}{[r^2+(z-z_s)^2]^{1/2}}e^{ik_0 [r^2+(z-z_s)^2]^{1/2}}
\end{equation}
where $z_s$ is the source depth. For small angles of propagation, $|\theta|=\frac{|z-z_s|}{r} \ll1$, so
\begin{equation}
p=\frac{1}{r}e^{ik_0\left[r+\frac{z-z_s)^2}{2r}\right]}=\frac{1}{\sqrt{r}}\Psi e^ik_0r.
\end{equation}
The corresponding form for $\Psi$ is found to satisfy a parabolic type equation. The general form of the parabolic approximation to the wave equation simply follows then from the acknowledgment that $\Psi$ is a slowly varying function in range and we may neglect the term $\frac{\partial ^2 \Psi}{\partial r^2}$. Thus, Eq. \ref{TH39} takes the form 
\begin{equation}\label{TH42}
\frac{\Psi}{r}=\frac{i}{2k_0}\frac{\partial ^2\Psi}{\partial z^2} + \frac{ik_0}{2}(n^2-1)\Psi.
\end{equation}

We have now reduced a second order differential equation to a first order one, thereby allowing solution via a non-iterative marching algorithm. Note that we may rewrite Eq. \ref{TH42} as
\begin{equation}
ik_0^{-1}\frac{\partial \Psi}{\partial r} = H_{op} \Psi = (T_{op} + U_{op})\Psi
\end{equation}
where the operators 
\begin{equation}\label{TH44}
T_{op} = -\frac{1}{2}\left(-ik_0^{-1}\frac{\partial}{\partial z}\right) ^2 = - \frac{1}{2k_0^2 }\frac{\partial ^2}{\partial z^2}
\end{equation}
and

\begin{equation}\label{TH45}
U_{op}=U(r,z,\varphi) = \frac{1}{2}(n^2-1).
\end{equation}
Therelationshipbetween the values $\Psi$ of  at different ranges can now be expressed as 
\begin{equation}
\Psi (r+\Delta r) = \Phi(r)\Psi(r)
\end{equation}
To propagate the solution out in rage requires a representation of the propagator $\Phi(r)$.
\subsection{Split-Step Fourier Transform Method}
There are three common methods of computing PE solutions: (1)the split-step Fourier (PE/ 
SSF) method (Hardin and Tappert, 1973), (2) the implicit Þnite difference (IFD-PE) method (e.g., 
Lee and Botseas, 1982), and (3) the Þnite element (FEPE) method (e.g.,Collins,1988). Since the first technique is used in this study, we shall isolate our discussion to the implementation of the 
PE/SSF method.  This is easily accomplished by approximating the propagator function by 
\begin{equation}
\Phi(r)\approx e^{-ik_0\overline{H}_{op}(r)\Delta r}
\end{equation}
where
\begin{equation}\label{TH48}
\overline{H}_{op}(r)=\frac{1}{\Delta r}\int_r^{r+\Delta r} dr' H_{op}(r').
\end{equation}
Using a Dyson time evolution operator, 
\begin{equation}
\Psi(r+\Delta r)=\mathbf Te^{-ik_0\int_r^{r+\Delta r} dr' H_{op}(r')}\Psi(r)
\end{equation}
where
\begin{eqnarray}
\mathbf T e^{-ik_0\int_r^{r+\Delta r} dr' H_{op}(r')}=1&-ik_0\int_r^{r+\Delta r} dr' H_{op}(r')
-k_o^2\int_r^{r+\Delta r} dr' \int^{r''}_r dr''H_{op}(r'')H_{op}(r')  \nonumber\\
&+ \mbox{(higher order terms)}.
\end{eqnarray}
The first order approximation is 
\begin{equation}
\Psi(r+\Delta r) = e^{-ik_0\int_r^{r+\Delta r} dr' H_{op}(r')}\Psi(r).
\end{equation}
To evaluate $\overline{H}_{op}$ defined in Eq.\ref{TH48}. Two common approximations are 
\begin{equation}
\overline{H}_{op} = H_{op}\left(r+\frac{1}{2}\Delta r\right)
\end{equation}
and simply
\begin{equation}
\overline{H}_{op} = H_{op} \left( r\right).
\end{equation}
There are sometimes referred to as the \textquotedblleft centered\textquotedblright and \textquotedblleft end point\textquotedblright schemes, respectively. The 
interpretation of these approximations is that, over the range step $r$ to $r+\Delta r$,the operator( hence the environment) is sampled at either the middle or the beginning of the range step.  Presumably, if  is small enough the differences between the solutions are negligible. We use the \textquotedblleft centered\textquotedblright scheme in this study. 

The operator is simply a multiplication operator in $z$-space and, hence, is a diagonal
matrix. The operator $T_{op}$ is not diagonal in $z$-space so different depth eigenfunctions are coupled. In wavenumber space, however, the corresponding operator $\hat{T_{op}}$ is diagonal. It is desirable, therefore, to separate the application of each operator, one in $z$-space and one in $k$-space. Using the Baker-Campbell-Hausdorff expansion (Bellman, 1964), we may write
\begin{equation}
e^{A+B}=e^Ae^Be^{[A,B]+[A,[A,B]]+[B,[B,A]]+\ldots}
\end{equation}
where $A=-ik_0\Delta r T_{op}$ and $B=-ik_0\Delta r U_{op}$. Since both $T_{op}$ and $U_{op}$ are small then we assume their products are of second order and negligible. Finally then, we have
\begin{equation}
\Phi(r)=e^{-ik_0\Delta r T_{op} } e^{-ik_0 \Delta r U_{op}}
\end{equation}
Note that this separation of $H_{op}$ into two components, each of which is diagonal in some representation and can be applied independently of the other, is presumed by application of the SSF integration scheme. The various approximations used to separate the operator  $H_{op}$ are typically used to distinguish one type of PE/SSF model from another.
Note from Eq. (1.24) that if there are no losses present (i.e., $ImT_{op} = ImU_{op}=0$) then
\begin{equation}
\|\Phi(r)\|=1,
\end{equation}
and $\Phi(r)$ is a unitary operator. Therefore, the normalization condition is 
\begin{equation}
\|\Psi(r)\| = \int\limits_{-\infty}^{\infty}|\Psi(r,z)\|^2dz=\mbox{constant}.
\end{equation}
In other words, because of the formulation of the propagator, the PE/SSF scheme is conservative.
There are no intrinsic losses due to the numerical scheme.

The general algorithm behind the PE/SSF implementation is then as follows. The PE field
function $\Psi$ is specified at some range $r$ in the $z$-domain. A transformation is made to the $k$-domain followed by a multiplication of the $k$-space operator $e^{-ik_0\Delta r\hat{T}_{op} }$. The result is then transformed again to the $z$-domain and is followed by a multiplication of the $z$-space operator $e^{-ik_0\Delta r{U}_{op} }$. The final result is the field function at $r+\Delta r$. The FFT subroutine employed in the numerical code assumes the convention
\begin{equation}
\Psi(z)=\mbox{FFT}(\hat{\Psi}(k))
\end{equation}
and
\begin{equation}
\hat{\Psi}(k)=[\mbox{FFT}(\Psi^*(z))]^*.
\end{equation}
Therefore, the PE/SSF implementation can be represented by
\begin{equation}
\Psi(r+\Delta r, z)=e^{-ik_0 \Delta r U_{op}(r,z)} \times \mbox{FFT}\{e^{-ik_0\Delta r\hat{T}_{op} (r,k)}\times[\mbox{FFT}(\Psi^*(r,z))]^*\},
\end{equation}
where, in $k$-space,
\begin{equation}
\hat{T}_{op}(k)=\frac{1}{2}\left(\frac{k}{k_0}\right)^2.
\end{equation}
\subsection{Standard and Wide Angle Approximation}
Previously, we have assumed the operators took the forms defined by Eqs. \ref{TH44} and \ref{TH45}. These forms, which followed from the derivation of the parabolic equation \ref{TH42}, are commonly referred to as the Òstandard PEÓ or SPE forms and are only one set of a number of various operator forms. To obtain other, higher order forms, we return to the original wave equation \ref{TH35}. Still ignoring the source term and the azimuthal coupling term, we now define the pressure field as
\begin{equation}\label{TH62}
p(r,z)=\frac{1}{\sqrt{r}}u(r,z)
\end{equation}
The function $u(r,z)$ is identical to the pressure field in tow dimensions and the term $\large\frac{1}{\sqrt{r}}$ accounts for azimuthal spreading. Substituting Eq. \ref{TH62} into the Helmholtz equation in tow dimensions yields the far-field UNCA expression
\begin{equation}
\frac{\partial^2 u}{\partial r^2}+\frac{\partial ^2 u}{\partial z^2}+k_0^2n^2(r,z)u=0
\end{equation}
We introduce the operators
\begin{equation}
P_{op}=\frac{\partial}{\partial r}
\end{equation}
and
\begin{equation}
Q_{op}=\left(n^2+\frac{1}{k_0^2}\frac{\partial ^2}{\partial z^2}\right) ^{1/2}.
\end{equation}
Eq. \ref{TH62} then becomes
\begin{equation}
(P_{op}^2+k_0^2Q_{op}^2)u=0
\end{equation}
which can be factored as
\begin{equation}\label{TH67}
(P_{op}+ik_0Q_{op})(P_{op}-ik_0Q_{op})u+ik_0[p-{op},Q_{op}]u=0.
\end{equation}
The commutator $[P_{op},Q_{op}]$ is assumed negligible and is, in fact, exactly zero in layered media. Eq. \ref{TH67} therefore represents the combination of incoming and outgoing waves. The outgoing wave satisfies
\begin{equation}
P_{op}u=ik_0Q_{op}u
\end{equation}
or
\begin{equation}
-k_0^{-1}\frac{\partial u}{\partial r}=Q_{op}u.
\end{equation}

Introduce the notation
\begin{equation}\label{TH70}
\epsilon=n^2-1
\end{equation}
and
\begin{equation}\label{TH71}
\mu=\frac{1}{k_0^2}\frac{\partial^2}{\partial z^2}
\end{equation}
so
\begin{equation}
Q_{op}=(\mu+\epsilon +1)^{1/2}
\end{equation}
The first approximation follows from the assumption that both $\epsilon$ and $\mu$ are small compared to unity.
A binomial expansion yield
\begin{equation}
Q_{op}\approx Q_1=\frac{1}{2}\mu+\frac{1}{2}\epsilon+1.
\end{equation}
Substitution of Eq. \ref{TH70} and \ref{TH71} shows that this is, within an additive constant, the standard PE operator,
\begin{equation}
Q_1=Q_{SPE}=\frac{1}{2k_0^2}\frac{\partial^2}{\partial z^2}+\frac{1}{2}(n^2-1)+1.
\end{equation}
Interpreting the operator $\mu$ as $\Large\frac{k^2}{k_0^2}=sin^2\theta$ indicates that the assumption $\mu\ll1$ implies $sin^2\theta\approx\theta^2\ll1$, hence this is a small angle approximation. The condition $\epsilon\ll1$is simply interpreted as assuming primarily stratified media as is typical of most ocean regions. In fact, since $\epsilon = (n^2-1)\ll1$, we can further approximate this by $\epsilon\approx2(n-1)$ to obtain
\begin{equation}
Q_2=\frac{1}{2k_0^2}\frac{\partial^2}{\partial z^2}+(n-1)+1
\end{equation}
Both of these approximations were first recognized by Tappert(1977) in his original S[ringer-Verlag article.

A higher order approximation introduced by Thomson and Chapman (1983) is based on an operator splitting of 
\begin{equation}\label{TH76}
Q_3=Q_{WAPE}=(1+\mu)^{1/2} +[(1+\epsilon)^{1/2}-1].
\end{equation}
Invoking the operator identity
\begin{equation}
(1+\mu)^{1/2}=1+\mu[(1+\mu)^{1/2}+1]^{-1}
\end{equation}
and formulating Eq. \ref{TH76} in terms of $T_{op}$ and $U_{op}$ as 
\begin{equation}
Q_{op}=1-H_{op}=1-(T_{op}+U_{op})
\end{equation}
leads to 
\begin{equation}\label{TH79}
T_{WAPE}=-\frac{1}{k_0^2}\frac{\partial^2}{\partial z^2}\left[\left(1+\frac{1}{k_0^2}\frac{\partial^2}{\partial z^2}\right)^{1/2}+1\right]^{-1}
\end{equation}
and
\begin{equation}
U_{WAPE}=-(n-1).
\end{equation}
In wavenumber space, we may express Eq. \ref{TH79} as 
\begin{equation}
\hat{T}_{WAPE}(k)=\left(\frac{k}{k_0}\right)^2\left[\left(1-\left(\frac{k}{k_0}\right)^2\right)^{1/2}+1\right]^{-1}=1-\left[1-\left(\frac{k}{k_0}\right)^2\right]^{1/2}.
\end{equation}
Note that modes with $k>k_0$ are evanescent since
\begin{equation}
\hat{T}_{WAPE}(k>k_0)=1-i\left[\left(\frac{k}{k_0}\right)^2-1\right]^{1/2}.
\end{equation}
This is commonly referred to as the \textquotedblleft wide angle\textquotedblright approximation (WAPE), and is used in this study.

\section{A Brief introduction to Nonlinear Internal Waves (Soliton)}


\subsection{Reconstruction of 3D IW environment }
A detailed, accurate 3D environment is critical in order to model the acoustic propagation in the area, and for a better understanding of the acoustical phenomena occurred during the experiment. However, limited by the equipment and experiment conditions, environmental data usually can only be gathered at sparse mooring points (relative to the massive water body). Next, we explain how we reconstruct the 3D temperature field from various sources and sensors for event 50 during SW06 experiment. 
\subsubsection{The leading front of internal wave maintains a straight line}
Figure 2 shows the combined radar picture of IW at 21:30GMT and 22:00GMT from R/V Oceanus and R/V Sharp with sketched leading wave fronts (red dash line). While the internal wave fronts in general maintain relatively straight across the range (~10km), it does demonstrate some curved features under close examination. It's also worth noting that within the range of R/V Oceanus's radar (lower one), and the upper half of R/V Sharp's Radar, the wave fronts are indeed pretty straight, which leads us to believe a 3-segmented line could be a better approximation for a more accurate model without too much manual sketch.
Under this assumption, the interpolation on the x-y plane is done on the direction parallel to the IW fronts, i.e., perpendicular to the direction of wave propagation. 

\subsubsection{Waveform changes only slightly along fronts}

Figure \ref{fig:tfarm_dir} shows the temperature records during one internal wave event (Event 50) by 8 thermistor arrays in the farm and one attached to the WHOI receiver array (VHLA). Panel (a) is the arrays roughly perpendicular to the direction of the internal wave propagating (edge "a"), panel (b) is the arrays along the propagation direction (edge "b"). (Fig. \ref{fig:tfarm}) WHOI VHLA is added as a reference. 

Using the temperature at 30m as an indicator of the IW waveform, Fig \ref{fig:tfarm_dir} shows the  evolutions of IW waveform at two directions at the location close to the acoustic track. The lag is adjusted by aligning the edge of the data. We find the first two or three IW waves are quite stable on Edge ÒaÓ. Starting from wave number 4, there can have wave dissipation or wave merge. Notice the small wave inside the circle on "a" disappears after Shark VLA (SW54), or it can merge with another wave, they both are equally plausible. There are more visible variations along Edge "b" than on Edge "a". Since our interpolation/extrapolation is done on the direction of IW wave front, we expect it will match the real environment reasonably well.


\subsubsection{Constant internal wave speed and direction}

The speed and direction of the leading IW front are estimated from temperature sensor data as well as the measurements from radar images. Speed and direction are optimized with the MMSE (minimum mean square error) criteria. Consider the size of the T-farm, it is not as "local" as the other two estimation. Nevertheless, all three estimations show very similar results, and again confirmed by the radar observations. The consistence implies when the IW is passing the Shark-SW32 acoustic track, the wave package as a whole is stable in terms of both shape and moving velocity.

\begin{table*}[hc]
\caption{ Local velocity and direction of internal waves in event 50
\label{tab-iw_vel}}
\begin{center} 
\begin{tabular}{ | c| c | c |c|}
\hline \hline

Location&Moorings        & IW front direction & IW speed (m/min)      \\

                 \hline \hline
 Shark VLA & 54,14,15,16,17 & 38.3022& 55.6164\\
 \hline
 T-farm & 4-17, 30, 31 & 36.8208 & 53.6021\\
 \hline
 Madway  & 32,19,20&39.5210&57.6753\\
 \hline
 R/V Sharp Radar&&$\sim$40&57.5653\\
 \hline
 R/V Oceanus Radar&&$\sim$40&55.1065\\
 \hline
 \hline
\end{tabular} 
\end{center}
\end{table*}

\subsection{Water temperature extrapolation}
The water temperature data are collected by the thermistor string moorings at SW54 and SW32. Unfortunately, the surface sensor on SW32 lost during the experiment, and the next one is located at 15 meter down, thus some form of temperature extrapolation is necessary. 15 meter is the up bound of the fast-changing thermocline layer, which causes linear extrapolation to give unrealistic results Ð water temperature can be as hot as $40^\circ C$ at surface. Help comes from a single pressure-temperature sensor attached to the transducer J15. 

On Aug. 17th and 18th, J15 were deployed and recovered twice, during which the TD sensor generated 4 temperature profiles shown in Fig. \ref{fig:water_temp4}. The top layer of water is very well mixed, and the depth of it is about 15m. The highest water temperature is about 25C. Based on this observation, the water temperature extrapolation/interpolation is performed for depth $>$15m, for the water above 15m, we assume the it is well mixed, thus use the temperature measured at the top sensor(15m).

\subsection{Reconstruct a 3D temperature field}
Based on the estimated IW speed and direction, we can reconstruct a 3D temperature field. Figure 6 shows the reconstructed temperature field at various depths. The field is plotted in a new coordinate system. Imaging a coordinate system travel with the internal wave package, the y-axis is the vector from SW54 to SW32, and the direction of x-axis perpendicular to y-axis, and its length is the distance the IW traveled since 19:30, Aug 17th. A sketch of this coordinate system and its position relative to Earth system at 21:30 is draw in figure 1. The gray box in the middle is the area we try to reconstruct, and a few red lines represent the internal wave front.

The temperature fields at different depths are shown in Fig. 6. The track of Shark VLA during m1 ~ m5 transmission periods in the new system is marked as white lines at the bottom, SW32's as black and R/V Sharp's as blue. With different IW speed and direction, different temperature field can be constructed. The mean estimated IW speed ( 54.4293 m/min) and direction (51.0884 degree w.r.t. North) were used in figure 6. 
%
%\subsection{Verification against J15 TD sensor data}
%To verify the reconstructed temperature data, we can take a measurement with J15 at the reconstructed field. Assuming J15 is co-located with to R/V Sharp, we use J15 depth data and R/V Sharp GPS data. We also adjust the direction of IW, trying to find the best match. The results plotted below:
%
%The IW directions used in 4 plots are 51.0884 (mean), 53, 54 and 55. It will be too high expectation to achieve a perfect match between simulation and estimation. Instead, we focus on several major features, namely feature 1, 2, 3 and 4. For feature 3, instead of seeing it as a bunch of spikes, we treat it as one big peak. In this way, the best match is either when IW direction equals 53 or 54, or somewhere in between. 
%
%Two research vessels (R/V Sharp and R/V Oceanus) were following the internal wave during event 50. Radar images were being captured at the interval of 30sec. We lay the radar image on top of reconstructed temperature field to check how well these two matches. Figure \ref{fig: 3D_interp_radar} shows the reconstructed temperature field (depth = 30m) with radar image overlay before the internal wave arrived at the receiver (GMT21:11), the leading front arrived at the receiver array (GMT21:41) and after 3 wave fronts passed the acoustic track (GMT22:11). The gray half circle is the track of R/V Sharp, of which the radius is about 10km. Because of the position of R/V Oceanus, only a very small part of its radar covered the acoustic track (the lower left radar).




